import{a as c}from"./axios-Bo0ATomq.js";import{_ as E,c as p,b as i,a as e,g as V,F as x,f as C,t as n,w as I,r as g,o as f,e as y,v as k,h as b,i as w}from"./index-DCdbFpfK.js";var U={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"yu-t-200053",BASE_URL:"/HexSchool-2023Vue/w6/dist/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:m,VITE_PATH:u}=U,q={data(){return{carts:{},form:{user:{name:"",email:"",tel:"",address:""},message:""},isLoading:!1,loadingStatus:{loadingItem:""}}},methods:{getCart(){this.isLoading=!0;const o=`${m}/api/${u}/cart`;c.get(o).then(t=>{this.carts=t.data.data,this.isLoading=!1})},deleteCart(o){const t=`${m}/api/${u}/cart/${o}`;this.loadingStatus.loadingItem=o,c.delete(t).then(d=>{alert(d.data.message),this.getCart(),this.loadingStatus.loadingItem=""}).catch(d=>{alert(d.response.data.message)})},deleteAll(){const o=`${m}/api/${u}/carts`;this.loadingStatus.loadingItem=!0,c.delete(o).then(t=>{alert(t.data.message),this.getCart(),this.loadingStatus.loadingItem=""}).catch(t=>{alert(t.response.data.message)})},changeCartQty(o,t){const d={product_id:o.product_id,qty:t},v=`${m}/api/${u}/cart/${o.id}`;this.isLoading=!0,c.put(v,{data:d}).then(s=>{alert(s.data.message),this.getCart(),this.isLoading=!1}).catch(s=>{alert(s.response.data.message)})},createOrder(){const o=`${m}/api/${u}/order`,t=this.form;this.isLoading=!0,c.post(o,{data:t}).then(d=>{alert(d.data.message),this.$refs.form.resetForm(),this.getCart(),this.isLoading=!1}).catch(d=>{alert(d.response.data.message)})}},mounted(){this.getCart()}},F={class:"container"},T=e("h2",{class:"text-center"},"前台購物車",-1),A={class:"text-end my-3"},M=["disabled"],D={class:"table align-middle"},R=e("thead",null,[e("tr",null,[e("td",{width:"10%"}),e("td",{width:"40%"},"品名"),e("td",{width:"30%"},"數量 / 單位"),e("td",{width:"30%"},"單價")])],-1),B=["onClick","disabled"],O={class:"input-group"},H=["onUpdate:modelValue","onChange","disabled"],P=["value"],N={class:"input-group-text",for:"cart"},Q={class:"text-end"},z={class:"text-end"},j=e("td",{colspan:"3"},"總計",-1),G=e("td",{colspan:"3",class:"text-success"},"折扣價",-1),J={class:"text-success"},K={class:"row"},W={class:"mb-3"},X=e("label",{for:"email",class:"form-label"},"Email",-1),Y={class:"mb-3"},Z=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),$={class:"mb-3"},ee=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),te={class:"mb-3"},se=e("label",{for:"address",class:"form-label"},"收件人地址",-1),ae={class:"mb-3"},le=e("label",{for:"message",class:"form-label"},"留言",-1),oe={class:"text-end"},de=["disabled"];function ie(o,t,d,v,s,r){const S=g("VueLoading"),_=g("VeeField"),h=g("ErrorMessage"),L=g("VeeForm");return f(),p("div",F,[i(S,{active:s.isLoading},null,8,["active"]),T,e("div",A,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:t[0]||(t[0]=V((...a)=>r.deleteAll&&r.deleteAll(...a),["prevent"])),disabled:s.loadingStatus.loadingItem===!0|s.carts.total===0}," 清空購物車 ",8,M)]),e("table",D,[R,e("tbody",null,[(f(!0),p(x,null,C(s.carts.carts,a=>(f(),p("tr",{key:a.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:V(l=>r.deleteCart(a.id),["prevent"]),disabled:s.loadingStatus.loadingItem===a.id}," × ",8,B)]),e("td",null,n(a.product.title),1),e("td",null,[e("div",O,[y(e("select",{class:"form-select",id:"cart","onUpdate:modelValue":l=>a.qty=l,onChange:l=>r.changeCartQty(a,a.qty),disabled:s.loadingStatus.loadingItem===a.id},[(f(),p(x,null,C(20,l=>e("option",{key:l,value:l},n(l),9,P)),64))],40,H),[[k,a.qty]]),e("label",N,n(a.product.unit),1)])]),e("td",Q,"$ "+n(a.product.price),1)]))),128))]),e("tfoot",z,[e("tr",null,[j,e("td",null,"$ "+n(s.carts.total),1)]),e("tr",null,[G,e("td",J,"$ "+n(s.carts.final_total),1)])])]),e("div",K,[i(L,{onSubmit:r.createOrder,ref:"form",class:"col-md-6"},{default:I(({errors:a})=>[e("div",W,[X,i(_,{id:"email",name:"email",type:"email",class:b(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.form.user.email,"onUpdate:modelValue":t[1]||(t[1]=l=>s.form.user.email=l)},null,8,["class","modelValue"]),i(h,{name:"email",class:"invalid-feedback"})]),e("div",Y,[Z,i(_,{id:"name",name:"姓名",type:"text",class:b(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.form.user.name,"onUpdate:modelValue":t[2]||(t[2]=l=>s.form.user.name=l)},null,8,["class","modelValue"]),i(h,{name:"姓名",class:"invalid-feedback"})]),e("div",$,[ee,i(_,{id:"tel",name:"電話",type:"tel",class:b(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:"required|min:8",modelValue:s.form.user.tel,"onUpdate:modelValue":t[3]||(t[3]=l=>s.form.user.tel=l)},null,8,["class","modelValue"]),i(h,{name:"電話",class:"invalid-feedback"})]),e("div",te,[se,i(_,{id:"address",name:"地址",type:"text",class:b(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.form.user.address,"onUpdate:modelValue":t[4]||(t[4]=l=>s.form.user.address=l)},null,8,["class","modelValue"]),i(h,{name:"地址",class:"invalid-feedback"})]),e("div",ae,[le,y(e("textarea",{id:"message",name:"留言",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=l=>s.form.message=l)},null,512),[[w,s.form.message]])]),e("div",oe,[e("button",{type:"submit",class:"btn btn-danger mb-5",disabled:s.carts.total===0}," 送出訂單 ",8,de)])]),_:1},8,["onSubmit"])])])}const ce=E(q,[["render",ie]]);export{ce as default};
